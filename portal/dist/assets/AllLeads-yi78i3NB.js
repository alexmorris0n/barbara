import{m as P,d as f,o as l,h as i,u as se,r as m,c as $,U as ae,ap as le,e as u,w as c,f as s,t as h,T as re,Z as E,g as ne,j as n,k as d,l as y,M as ie,_ as ce,Y as ue}from"./index-Zmiy9vUZ.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{N as pe}from"./Space-C8optOo1.js";import{P as me}from"./PeopleOutline-aKbrOAhK.js";import{S as fe}from"./SearchOutline-Cw4z4GYE.js";import{N as k}from"./Icon-mzXUnXfI.js";import{N as ve}from"./Input-4_CfEX6A.js";import{N as we}from"./Card-CQehKaiG.js";import{a as F}from"./Select-xKNV0jSq.js";import{N as ke}from"./Spin-BZ8iyl2F.js";import{N as I}from"./Tag-BKoMbYoB.js";import"./browser-BZH80bmF.js";import"./fade-in-scale-up.cssr-DeT7XIyr.js";import"./Scrollbar-CDqUNXMD.js";import"./get-slot-Bk_rJcZu.js";import"./use-locale-BrVfMDBS.js";import"./use-merged-state-BdofJKEv.js";import"./Suffix-BXy4hTOo.js";import"./Popover-DQZh3cob.js";import"./get-C0N94DP8.js";import"./Empty-CD9t4KcR.js";import"./index-DsSU6HIH.js";const _e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},S=P({name:"ArrowDownOutline",render:function(D,_){return l(),f("svg",_e,_[0]||(_[0]=[i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 268l144 144l144-144"},null,-1),i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 392V100"},null,-1)]))}}),ge={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},b=P({name:"ArrowUpOutline",render:function(D,_){return l(),f("svg",ge,_[0]||(_[0]=[i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 244l144-144l144 144"},null,-1),i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 120v292"},null,-1)]))}}),ye={class:"leads-workspace"},he={class:"meta-card"},be={class:"meta-header"},Ce={class:"meta-title-wrap"},Se={class:"meta-count"},ze={class:"table-wrapper"},$e={class:"table-header-row"},Ne={class:"custom-table-body"},Le={key:0,class:"loading-row"},Ae=["onClick"],xe={class:"td-cell ellipsis"},Ue={class:"td-cell"},Ee={class:"td-cell"},Me={key:1},Te={class:"td-cell"},De={key:1},qe={key:0,class:"td-cell ellipsis"},Be={class:"td-cell"},Oe={class:"td-cell"},Fe=20,Ve={__name:"AllLeads",setup(V){const D=ne(),{isAdmin:_}=se(),q=m(!1),B=m([]),Y=m([]),j=m(!1),Z=m(1);$(()=>Z.value*Fe<O.value.length);const M=m(""),N=m([]),L=m([]),A=m([]),v=m("created_at"),p=m("desc"),R={new:"default",contacted:"info",replied:"warning",qualified:"success",appointment_set:"success",showed:"success",application:"success",funded:"success",closed_lost:"error",needs_contact_info:"warning",enriched:"info",contactable:"warning",do_not_contact:"error"},J={new:"default",queued:"default",active:"info",sent:"info",delivered:"warning",opened:"warning",clicked:"warning",replied:"success",bounced:"error",unsubscribed:"error",paused:"default",completed:"success",do_not_contact:"error",converted:"success"},Q=$(()=>["new","contacted","replied","qualified","appointment_set","showed","application","funded","closed_lost","needs_contact_info"].map(e=>({label:T(e),value:e}))),W=$(()=>["new","queued","active","sent","delivered","opened","clicked","replied","bounced","unsubscribed","paused","completed","do_not_contact","converted"].map(e=>({label:T(e),value:e}))),G=$(()=>Y.value.map(o=>({label:o.company_name||"Unknown",value:o.id}))),O=$(()=>{let o=B.value;if(o=o.filter(e=>e.status!=="needs_contact_info"),M.value){const e=M.value.toLowerCase();o=o.filter(t=>{const a=`${t.first_name||""} ${t.last_name||""}`.toLowerCase(),r=(t.property_address||"").toLowerCase(),g=(t.property_city||"").toLowerCase(),w=(t.property_zip||"").toLowerCase();return a.includes(e)||r.includes(e)||g.includes(e)||w.includes(e)})}return N.value&&N.value.length>0&&(o=o.filter(e=>N.value.includes(e.status))),L.value&&L.value.length>0&&(o=o.filter(e=>L.value.includes(e.campaign_status))),A.value&&A.value.length>0&&(o=o.filter(e=>A.value.includes(e.assigned_broker_id))),o.sort((e,t)=>{let a,r;switch(v.value){case"name":a=`${e.first_name||""} ${e.last_name||""}`.trim().toLowerCase(),r=`${t.first_name||""} ${t.last_name||""}`.trim().toLowerCase();break;case"zip":a=e.property_zip||"",r=t.property_zip||"";break;case"age":a=e.age||0,r=t.age||0;break;case"broker":a=(e.broker_name||"Unassigned").toLowerCase(),r=(t.broker_name||"Unassigned").toLowerCase();break;case"status":a=e.status||"",r=t.status||"";break;case"campaign":a=e.campaign_status||"",r=t.campaign_status||"";break;case"created_at":default:a=new Date(e.created_at||0),r=new Date(t.created_at||0);break}return p.value==="asc"?a>r?1:a<r?-1:0:a<r?1:a>r?-1:0}),o}),H=$(()=>O.value);function T(o){return o?o.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"N/A"}function K(o){console.log("formatAge called with:",o);const e=[];if(o.age&&e.push(`${o.age}y`),o.created_at){const a=new Date(o.created_at),g=Math.abs(new Date-a),w=Math.ceil(g/(1e3*60*60*24));e.push(`${w}d`)}const t=e.length>0?e.join(", "):"N/A";return console.log("formatAge result:",t),t}function X(o){if(!o)return"Never";const e=new Date(o),a=new Date-e,r=Math.floor(a/6e4);if(r<1)return"Just now";if(r<60)return`${r}m`;const g=Math.floor(r/60);if(g<24)return`${g}h`;const w=Math.floor(g/24);if(w<7)return`${w}d`;const z=Math.floor(w/7);return z<4?`${z}w`:e.toLocaleDateString()}async function ee(){var o,e;q.value=!0;try{const{data:{user:t}}=await E.auth.getUser();console.log("ðŸ” Current user in loadLeads:",t),console.log("ðŸ” User role:",(o=t==null?void 0:t.app_metadata)==null?void 0:o.user_role);const{data:a,error:r}=await E.from("leads").select("*").order("created_at",{ascending:!1});if(console.log("ðŸ” Leads query result:",{leadsData:a,leadsError:r}),r)throw r;const{data:g,error:w}=await E.from("brokers").select("id, company_name");if(w)throw w;const z={};g.forEach(U=>{z[U.id]=U.company_name}),console.log("Broker map:",z),console.log("First lead:",a==null?void 0:a[0]),B.value=(a||[]).map(U=>({...U,broker_name:z[U.assigned_broker_id]||"Unassigned"})),console.log("First mapped lead:",B.value[0])}catch(t){console.error("Failed to load leads:",t),(e=window.$message)==null||e.error("Failed to load leads")}finally{q.value=!1}}async function te(){try{const{data:{user:o}}=await E.auth.getUser();console.log("Current authenticated user:",o);const{data:e,error:t}=await E.from("brokers").select("id, company_name").order("company_name",{ascending:!0});if(console.log("Brokers query result:",e,"Error:",t),t)throw t;Y.value=e||[]}catch(o){console.error("Failed to load brokers:",o)}}function x(){const o=document.querySelectorAll("*");let e=!1;for(let a of o){const r=window.getComputedStyle(a);if((r.overflow==="auto"||r.overflow==="scroll"||r.overflowY==="auto"||r.overflowY==="scroll")&&a.scrollHeight>a.clientHeight&&a.scrollTop>100){e=!0;break}}const t=window.pageYOffset||document.documentElement.scrollTop;j.value=e||t>100}function oe(){const o=document.querySelectorAll("*");let e=null;for(let t of o){const a=window.getComputedStyle(t);if((a.overflow==="auto"||a.overflow==="scroll"||a.overflowY==="auto"||a.overflowY==="scroll")&&t.scrollHeight>t.clientHeight&&t.scrollTop>0){e=t;break}}e?e.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}function C(o){v.value===o?p.value=p.value==="asc"?"desc":"asc":(v.value=o,p.value="asc")}return ae(()=>{ee(),te(),window.addEventListener("scroll",x),setTimeout(()=>{document.querySelectorAll("*").forEach(e=>{const t=window.getComputedStyle(e);(t.overflow==="auto"||t.overflow==="scroll"||t.overflowY==="auto"||t.overflowY==="scroll")&&e.scrollHeight>e.clientHeight&&e.addEventListener("scroll",x)})},1e3)}),le(()=>{window.removeEventListener("scroll",x);const o=document.querySelector(".n-layout-scroll-container");o&&o.removeEventListener("scroll",x);const e=document.querySelector(".leads-workspace");e&&e.removeEventListener("scroll",x)}),(o,e)=>(l(),f("div",ye,[i("section",he,[i("header",be,[i("div",Ce,[u(s(k),{size:"20",class:"meta-icon"},{default:c(()=>[u(s(me))]),_:1}),e[11]||(e[11]=i("span",{class:"meta-title"},"All Leads",-1)),i("span",Se,"("+h(O.value.length)+")",1)])]),u(s(ve),{value:M.value,"onUpdate:value":e[0]||(e[0]=t=>M.value=t),placeholder:"Search name, address, city, or ZIP...",clearable:"",size:"medium",style:{"margin-top":"0.75rem"}},{prefix:c(()=>[u(s(k),null,{default:c(()=>[u(s(fe))]),_:1})]),_:1},8,["value"]),u(s(pe),{size:12,style:{"margin-top":"0.75rem"}},{default:c(()=>[u(s(F),{value:N.value,"onUpdate:value":e[1]||(e[1]=t=>N.value=t),placeholder:"Status",clearable:"",multiple:"",options:Q.value,size:"small",style:{"min-width":"140px"}},null,8,["value","options"]),u(s(F),{value:L.value,"onUpdate:value":e[2]||(e[2]=t=>L.value=t),placeholder:"Campaign Status",clearable:"",multiple:"",options:W.value,size:"small",style:{"min-width":"160px"}},null,8,["value","options"]),s(_)?(l(),n(s(F),{key:0,value:A.value,"onUpdate:value":e[3]||(e[3]=t=>A.value=t),placeholder:"Broker",clearable:"",multiple:"",options:G.value,size:"small",style:{"min-width":"140px"}},null,8,["value","options"])):d("",!0)]),_:1})]),u(s(we),{class:"editor-card",bordered:!1},{default:c(()=>[i("div",ze,[i("div",$e,[i("div",{class:"th-cell sortable",onClick:e[4]||(e[4]=t=>C("name"))},[e[12]||(e[12]=y(" Name ",-1)),v.value==="name"?(l(),n(s(k),{key:0,size:"14",class:"sort-icon"},{default:c(()=>[p.value==="asc"?(l(),n(s(b),{key:0})):(l(),n(s(S),{key:1}))]),_:1})):d("",!0)]),i("div",{class:"th-cell sortable",onClick:e[5]||(e[5]=t=>C("zip"))},[e[13]||(e[13]=y(" ZIP ",-1)),v.value==="zip"?(l(),n(s(k),{key:0,size:"14",class:"sort-icon"},{default:c(()=>[p.value==="asc"?(l(),n(s(b),{key:0})):(l(),n(s(S),{key:1}))]),_:1})):d("",!0)]),i("div",{class:"th-cell sortable",onClick:e[6]||(e[6]=t=>C("status"))},[e[14]||(e[14]=y(" Status ",-1)),v.value==="status"?(l(),n(s(k),{key:0,size:"14",class:"sort-icon"},{default:c(()=>[p.value==="asc"?(l(),n(s(b),{key:0})):(l(),n(s(S),{key:1}))]),_:1})):d("",!0)]),i("div",{class:"th-cell sortable",onClick:e[7]||(e[7]=t=>C("campaign"))},[e[15]||(e[15]=y(" Campaign ",-1)),v.value==="campaign"?(l(),n(s(k),{key:0,size:"14",class:"sort-icon"},{default:c(()=>[p.value==="asc"?(l(),n(s(b),{key:0})):(l(),n(s(S),{key:1}))]),_:1})):d("",!0)]),s(_)?(l(),f("div",{key:0,class:"th-cell sortable",onClick:e[8]||(e[8]=t=>C("broker"))},[e[16]||(e[16]=y(" Broker ",-1)),v.value==="broker"?(l(),n(s(k),{key:0,size:"14",class:"sort-icon"},{default:c(()=>[p.value==="asc"?(l(),n(s(b),{key:0})):(l(),n(s(S),{key:1}))]),_:1})):d("",!0)])):d("",!0),i("div",{class:"th-cell sortable",onClick:e[9]||(e[9]=t=>C("age"))},[e[17]||(e[17]=y(" Age ",-1)),v.value==="age"?(l(),n(s(k),{key:0,size:"14",class:"sort-icon"},{default:c(()=>[p.value==="asc"?(l(),n(s(b),{key:0})):(l(),n(s(S),{key:1}))]),_:1})):d("",!0)]),i("div",{class:"th-cell sortable",onClick:e[10]||(e[10]=t=>C("created_at"))},[e[18]||(e[18]=y(" Activity ",-1)),v.value==="created_at"?(l(),n(s(k),{key:0,size:"14",class:"sort-icon"},{default:c(()=>[p.value==="asc"?(l(),n(s(b),{key:0})):(l(),n(s(S),{key:1}))]),_:1})):d("",!0)])]),i("div",Ne,[q.value&&H.value.length===0?(l(),f("div",Le,[u(s(ke),{size:"small"})])):d("",!0),(l(!0),f(ie,null,ce(H.value,(t,a)=>(l(),f("div",{key:t.id,class:ue(["table-row",{striped:a%2===1}]),onClick:r=>s(D).push(`/leads/${t.id}`)},[i("div",xe,h(`${t.first_name||""} ${t.last_name||""}`.trim()||"Unknown"),1),i("div",Ue,h(t.property_zip||"N/A"),1),i("div",Ee,[t.status?(l(),n(s(I),{key:0,type:R[t.status]||"default",size:"small",round:""},{default:c(()=>[y(h(T(t.status)),1)]),_:2},1032,["type"])):(l(),f("span",Me,"N/A"))]),i("div",Te,[t.campaign_status?(l(),n(s(I),{key:0,type:J[t.campaign_status]||"default",size:"small",round:""},{default:c(()=>[y(h(T(t.campaign_status)),1)]),_:2},1032,["type"])):(l(),f("span",De,"N/A"))]),s(_)?(l(),f("div",qe,h(t.broker_name||"Unassigned"),1)):d("",!0),i("div",Be,h(K(t)),1),i("div",Oe,h(X(t.last_contact||t.updated_at)),1)],10,Ae))),128))])])]),_:1}),u(re,{name:"fade"},{default:c(()=>[j.value?(l(),f("button",{key:0,onClick:oe,class:"scroll-to-top","aria-label":"Scroll to top"},[u(s(k),{size:"24"},{default:c(()=>[u(s(b))]),_:1})])):d("",!0)]),_:1})]))}},ct=de(Ve,[["__scopeId","data-v-dbccbce3"]]);export{ct as default};
