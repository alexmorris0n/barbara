import{m as O,d as m,o as c,h as l,a0 as q,u as Z,r as f,c as D,U as P,g as R,e as o,k as U,j as Q,w as n,f as t,M as Y,_ as H,Z as j,l as M,t as d,Y as K}from"./index-Zmiy9vUZ.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as W}from"./use-message-CU8WL__e.js";import{B as N}from"./Button-DKNg9UAj.js";import{N as G}from"./Modal-iEU3BR_n.js";import{N as ee}from"./Spin-BZ8iyl2F.js";import{N as ae}from"./Empty-CD9t4KcR.js";import{S as te}from"./SearchOutline-Cw4z4GYE.js";import{N as oe}from"./InputNumber-COvc0zTj.js";import{M as le}from"./MailOutline-BTBQ_rdf.js";import{C as re}from"./CallOutline-IC-WCiGr.js";import{L as se}from"./LocationOutline-Y6npm2Rb.js";import{N as _}from"./Input-4_CfEX6A.js";import{N as v}from"./Icon-mzXUnXfI.js";import{N as ne}from"./Form-kuquhUr4.js";import{N as h}from"./FormItem-D11vT_m1.js";import"./browser-BZH80bmF.js";import"./Card-CQehKaiG.js";import"./fade-in-scale-up.cssr-DeT7XIyr.js";import"./Scrollbar-CDqUNXMD.js";import"./index-DsSU6HIH.js";import"./use-locale-BrVfMDBS.js";import"./use-merged-state-BdofJKEv.js";import"./Add-B0X-9vGl.js";import"./Suffix-BXy4hTOo.js";import"./get-C0N94DP8.js";const ie={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ue=O({name:"AddOutline",render:function(y,u){return c(),m("svg",ie,u[0]||(u[0]=[l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1)]))}}),de={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ce=O({name:"BusinessOutline",render:function(y,u){return c(),m("svg",de,u[0]||(u[0]=[q('<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M176 416v64"></path><path d="M80 32h192a32 32 0 0 1 32 32v412a4 4 0 0 1-4 4H48h0V64a32 32 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path d="M320 192h112a32 32 0 0 1 32 32v256h0h-160h0V208a16 16 0 0 1 16-16z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path d="M98.08 431.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M98.08 351.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M98.08 271.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M98.08 191.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M98.08 111.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M178.08 351.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M178.08 271.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M178.08 191.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M178.08 111.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M258.08 431.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M258.08 351.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M258.08 271.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><ellipse cx="256" cy="176" rx="15.95" ry="16.03" transform="rotate(-45 255.99 175.996)" fill="currentColor"></ellipse><path d="M258.08 111.87a16 16 0 1 1 13.79-13.79a16 16 0 0 1-13.79 13.79z" fill="currentColor"></path><path d="M400 400a16 16 0 1 0 16 16a16 16 0 0 0-16-16z" fill="currentColor"></path><path d="M400 320a16 16 0 1 0 16 16a16 16 0 0 0-16-16z" fill="currentColor"></path><path d="M400 240a16 16 0 1 0 16 16a16 16 0 0 0-16-16z" fill="currentColor"></path><path d="M336 400a16 16 0 1 0 16 16a16 16 0 0 0-16-16z" fill="currentColor"></path><path d="M336 320a16 16 0 1 0 16 16a16 16 0 0 0-16-16z" fill="currentColor"></path><path d="M336 240a16 16 0 1 0 16 16a16 16 0 0 0-16-16z" fill="currentColor"></path>',23)]))}}),pe={class:"broker-management"},me={class:"management-header"},fe={class:"header-actions"},_e={style:{display:"flex",gap:"0.5rem","justify-content":"flex-end"}},he={key:0,class:"loading-state"},ve={key:1,class:"broker-grid"},ye=["onClick"],ke={class:"status-badge"},Ce={class:"card-header"},ge={class:"broker-avatar"},we={class:"broker-info"},be={class:"company"},Me={class:"card-body"},Ne={class:"info-row"},xe={class:"info-text"},ze={class:"info-row"},Be={class:"info-text"},Ie={class:"info-row"},Ae={class:"info-text"},Se={class:"info-row"},Ue={class:"info-text"},je={class:"card-footer"},Oe={class:"stat"},Ve={class:"stat-value"},Le={class:"stat"},$e={class:"stat-value"},Fe={key:2,class:"empty-state"},Ee={__name:"BrokerManagement",setup(x){const y=R(),u=W(),{isAdmin:V,isBroker:L,userProfile:z}=Z(),w=f([]),C=f(!0),g=f(""),k=f(!1),b=f(!1),B=f(null),s=f({contact_name:"",company_name:"",email:"",phone:"",nmls_number:"",license_states:"",daily_lead_capacity:5}),$={contact_name:{required:!0,message:"Contact name is required",trigger:"blur"},company_name:{required:!0,message:"Company name is required",trigger:"blur"},email:{required:!0,type:"email",message:"Valid email is required",trigger:"blur"}},I=D(()=>{if(!g.value)return w.value;const r=g.value.toLowerCase();return w.value.filter(e=>{var a,i,p,S;return((a=e.contact_name)==null?void 0:a.toLowerCase().includes(r))||((i=e.company_name)==null?void 0:i.toLowerCase().includes(r))||((p=e.email)==null?void 0:p.toLowerCase().includes(r))||((S=e.nmls_number)==null?void 0:S.includes(r))})});async function A(){C.value=!0;try{const{data:r,error:e}=await j.from("brokers").select("*").order("contact_name",{ascending:!0});if(e)throw e;const{data:a}=await j.from("user_profiles").select("broker_id").not("broker_id","is",null),i=new Set((a==null?void 0:a.map(p=>p.broker_id))||[]);w.value=(r||[]).map(p=>({...p,has_portal_access:i.has(p.id),display_status:i.has(p.id)?"active":"invite_pending"}))}catch(r){console.error("Error loading brokers:",r),u.error("Failed to load brokers")}finally{C.value=!1}}async function F(){var r;try{await((r=B.value)==null?void 0:r.validate())}catch{return}b.value=!0;try{const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14bnFmd3VodnVyYWpyZ29lZnlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NzU3OTAsImV4cCI6MjA3NTQ1MTc5MH0.QMoZAjIKkB05Vr9nM1FKbC2ke5RTvfv6zrSDU0QMuN4",a=await fetch("https://mxnqfwuhvurajrgoefyg.supabase.co/functions/v1/invite-broker",{method:"POST",mode:"cors",credentials:"omit",headers:{"Content-Type":"application/json",...e?{apikey:e}:{}},body:JSON.stringify({contact_name:s.value.contact_name,company_name:s.value.company_name,email:s.value.email,phone:s.value.phone||null,nmls_number:s.value.nmls_number||null,license_states:s.value.license_states||null,daily_lead_capacity:s.value.daily_lead_capacity})}),i=await a.json();if(!a.ok)throw new Error(i.error||"Failed to create broker");i.email_sent?u.success("Broker created! Invite email sent."):u.success("Broker created! (Email not configured - share login link manually)"),k.value=!1,s.value={contact_name:"",company_name:"",email:"",phone:"",nmls_number:"",license_states:"",daily_lead_capacity:5},await A(),i.broker_id&&y.push(`/brokers/${i.broker_id}`)}catch(e){console.error("Error creating broker:",e),u.error(e.message||"Failed to create broker")}finally{b.value=!1}}function E(r){y.push(`/brokers/${r}`)}function J(r){if(!r)return"B";const e=r.trim().split(/\s+/);return e.length>=2?(e[0][0]+e[e.length-1][0]).toUpperCase():r[0].toUpperCase()}function T(r){if(!r)return"N/A";const e=r.replace(/\D/g,"");return e.length===10?`(${e.slice(0,3)}) ${e.slice(3,6)}-${e.slice(6)}`:r}return P(()=>{var r;if(L.value&&((r=z.value)!=null&&r.broker_id)){y.replace(`/brokers/${z.value.broker_id}`);return}A()}),(r,e)=>(c(),m("div",pe,[l("div",me,[l("div",fe,[o(t(_),{value:g.value,"onUpdate:value":e[0]||(e[0]=a=>g.value=a),placeholder:"Search brokers...",clearable:"",style:{flex:"1"}},{prefix:n(()=>[o(t(v),null,{default:n(()=>[o(t(te))]),_:1})]),_:1},8,["value"]),t(V)?(c(),Q(t(N),{key:0,type:"primary",onClick:e[1]||(e[1]=a=>k.value=!0)},{icon:n(()=>[o(t(v),null,{default:n(()=>[o(t(ue))]),_:1})]),default:n(()=>[e[11]||(e[11]=M(" Add Broker ",-1))]),_:1})):U("",!0)])]),o(t(G),{show:k.value,"onUpdate:show":e[10]||(e[10]=a=>k.value=a),preset:"card",title:"Add New Broker",style:{width:"600px","max-width":"90vw"}},{footer:n(()=>[l("div",_e,[o(t(N),{onClick:e[9]||(e[9]=a=>k.value=!1)},{default:n(()=>[...e[12]||(e[12]=[M("Cancel",-1)])]),_:1}),o(t(N),{type:"primary",loading:b.value,onClick:F},{default:n(()=>[...e[13]||(e[13]=[M(" Create Broker ",-1)])]),_:1},8,["loading"])])]),default:n(()=>[o(t(ne),{ref_key:"formRef",ref:B,model:s.value,rules:$},{default:n(()=>[o(t(h),{label:"Contact Name",path:"contact_name"},{default:n(()=>[o(t(_),{value:s.value.contact_name,"onUpdate:value":e[2]||(e[2]=a=>s.value.contact_name=a),placeholder:"John Smith"},null,8,["value"])]),_:1}),o(t(h),{label:"Company Name",path:"company_name"},{default:n(()=>[o(t(_),{value:s.value.company_name,"onUpdate:value":e[3]||(e[3]=a=>s.value.company_name=a),placeholder:"ABC Mortgage"},null,8,["value"])]),_:1}),o(t(h),{label:"Email",path:"email"},{default:n(()=>[o(t(_),{value:s.value.email,"onUpdate:value":e[4]||(e[4]=a=>s.value.email=a),placeholder:"john@example.com"},null,8,["value"])]),_:1}),o(t(h),{label:"Phone",path:"phone"},{default:n(()=>[o(t(_),{value:s.value.phone,"onUpdate:value":e[5]||(e[5]=a=>s.value.phone=a),placeholder:"(555) 123-4567"},null,8,["value"])]),_:1}),o(t(h),{label:"NMLS Number",path:"nmls_number"},{default:n(()=>[o(t(_),{value:s.value.nmls_number,"onUpdate:value":e[6]||(e[6]=a=>s.value.nmls_number=a),placeholder:"123456"},null,8,["value"])]),_:1}),o(t(h),{label:"License States",path:"license_states"},{default:n(()=>[o(t(_),{value:s.value.license_states,"onUpdate:value":e[7]||(e[7]=a=>s.value.license_states=a),placeholder:"CA, AZ, NV"},null,8,["value"])]),_:1}),o(t(h),{label:"Daily Lead Capacity",path:"daily_lead_capacity"},{default:n(()=>[o(t(oe),{value:s.value.daily_lead_capacity,"onUpdate:value":e[8]||(e[8]=a=>s.value.daily_lead_capacity=a),min:1,max:100},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),C.value?(c(),m("div",he,[o(t(ee),{size:"large"})])):(c(),m("div",ve,[(c(!0),m(Y,null,H(I.value,a=>(c(),m("div",{key:a.id,class:"broker-card",onClick:i=>E(a.id)},[l("div",{class:K(["card-status",a.display_status])},[l("span",ke,d(a.has_portal_access?"Active":"Invite Pending"),1)],2),l("div",Ce,[l("div",ge,d(J(a.contact_name)),1),l("div",we,[l("h3",null,d(a.contact_name),1),l("p",be,d(a.company_name),1)])]),l("div",Me,[l("div",Ne,[o(t(v),{class:"info-icon"},{default:n(()=>[o(t(le))]),_:1}),l("span",xe,d(a.email),1)]),l("div",ze,[o(t(v),{class:"info-icon"},{default:n(()=>[o(t(re))]),_:1}),l("span",Be,d(T(a.phone)),1)]),l("div",Ie,[o(t(v),{class:"info-icon"},{default:n(()=>[o(t(ce))]),_:1}),l("span",Ae,"NMLS: "+d(a.nmls_number),1)]),l("div",Se,[o(t(v),{class:"info-icon"},{default:n(()=>[o(t(se))]),_:1}),l("span",Ue,d(a.license_states||"N/A"),1)])]),l("div",je,[l("div",Oe,[e[14]||(e[14]=l("span",{class:"stat-label"},"Performance",-1)),l("span",Ve,d(a.performance_score)+"%",1)]),l("div",Le,[e[15]||(e[15]=l("span",{class:"stat-label"},"Daily Capacity",-1)),l("span",$e,d(a.daily_lead_capacity),1)])])],8,ye))),128))])),!C.value&&I.value.length===0?(c(),m("div",Fe,[o(t(ae),{description:"No brokers found"})])):U("",!0)]))}},pa=X(Ee,[["__scopeId","data-v-a919b04e"]]);export{pa as default};
