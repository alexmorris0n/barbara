import{m as J,n as ve,r as g,B as fe,d as i,o as l,h as s,c as ye,U as he,ap as ge,e as d,w as c,f as n,j as w,k as u,M as z,W as we,Z as Y,t as r,l as f,_ as G,Y as E,aN as be}from"./index-Zmiy9vUZ.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{B as S}from"./Button-DKNg9UAj.js";import{A as $,P as Ce}from"./PhonePortraitOutline-3P-9kg3C.js";import{L as x}from"./LocationOutline-Y6npm2Rb.js";import{C as Me,T as H}from"./TimeOutline-DPIfqeY6.js";import{S as Se}from"./Scrollbar-CDqUNXMD.js";import{C as Ae}from"./CalendarOutline-BhKeG2Nz.js";import{C as Ne}from"./CallOutline-IC-WCiGr.js";import{M as I}from"./MailOutline-BTBQ_rdf.js";import{N as P}from"./Card-CQehKaiG.js";import{N as Te}from"./Modal-iEU3BR_n.js";import{N as y}from"./Icon-mzXUnXfI.js";import{N as C}from"./Tag-BKoMbYoB.js";import{N as Oe}from"./Spin-BZ8iyl2F.js";import"./browser-BZH80bmF.js";import"./fade-in-scale-up.cssr-DeT7XIyr.js";import"./index-DsSU6HIH.js";const ze=Object.assign(Object.assign({},fe.props),{trigger:String,xScrollable:Boolean,onScroll:Function,contentClass:String,contentStyle:[Object,String],size:Number,yPlacement:{type:String,default:"right"},xPlacement:{type:String,default:"bottom"}}),Ee=J({name:"Scrollbar",props:ze,setup(){const b=g(null);return Object.assign(Object.assign({},{scrollTo:(...v)=>{var a;(a=b.value)===null||a===void 0||a.scrollTo(v[0],v[1])},scrollBy:(...v)=>{var a;(a=b.value)===null||a===void 0||a.scrollBy(v[0],v[1])}}),{scrollbarInstRef:b})},render(){return ve(Se,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}}),$e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Z=J({name:"ChatboxOutline",render:function(A,v){return l(),i("svg",$e,v[0]||(v[0]=[s("path",{d:"M408 64H104a56.16 56.16 0 0 0-56 56v192a56.16 56.16 0 0 0 56 56h40v80l93.72-78.14a8 8 0 0 1 5.13-1.86H408a56.16 56.16 0 0 0 56-56V120a56.16 56.16 0 0 0-56-56z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),xe={class:"lead-detail-workspace"},Ie={class:"back-button-container"},Pe={class:"lead-detail-grid"},je={class:"left-column"},Le={class:"lead-header"},Ue={class:"lead-name"},De={class:"lead-status"},Be={class:"lead-info-grid"},qe={class:"info-column"},Re={class:"detail-row"},Fe={class:"detail-value"},Ke={class:"detail-row"},Ve={class:"detail-value"},Ye={class:"detail-row"},Ge={class:"detail-value property-address"},He={class:"info-column"},Ze={key:0,class:"detail-row"},Je={class:"detail-value"},We={key:1,class:"detail-row"},Qe={class:"detail-value"},Xe={key:2,class:"detail-row"},es={class:"detail-value"},ss={class:"map-container"},ts={key:0,class:"no-address"},os={key:1,class:"map-wrapper"},as=["src"],ls={key:1,style:{padding:"1rem",background:"#f0f0f0","border-radius":"8px",margin:"1rem 0"}},ns={key:2,class:"map-placeholder"},rs={class:"map-actions"},is={class:"right-column"},ds={key:0,class:"loading-state"},cs={key:1,class:"empty-state"},us={key:2,class:"timeline"},ps={class:"timeline-content"},ms={class:"timeline-header-info"},_s={class:"timeline-title"},vs={class:"interaction-type"},fs={class:"timeline-time"},ys={key:0,class:"timeline-subject"},hs={key:1,class:"timeline-content-text"},gs={key:2,class:"timeline-meta"},ws={key:3,class:"timeline-outcome"},bs={class:"outcome-content"},ks={key:4,class:"timeline-evaluation"},Cs={class:"evaluation-summary"},Ms={key:0,class:"transcript-modal"},Ss={class:"transcript-header"},As={class:"call-info"},Ns={class:"call-meta"},Ts={class:"call-date"},Os={key:0,class:"call-duration"},zs={key:1,class:"call-outcome"},Es={key:0,class:"evaluation-scores"},$s={class:"scores-grid"},xs={class:"score-item"},Is={class:"score-value"},Ps={class:"score-item"},js={class:"score-value"},Ls={class:"score-item"},Us={class:"score-value"},Ds={class:"score-item"},Bs={class:"score-value"},qs={class:"score-item"},Rs={class:"score-value"},Fs={class:"score-item"},Ks={class:"score-value"},Vs={class:"transcript-content"},Ys={key:0,class:"transcript-messages"},Gs={class:"message-header"},Hs={class:"speaker"},Zs={class:"timestamp"},Js={class:"message-bubble"},Ws={class:"message-content"},Qs={key:1,class:"no-transcript"},Xs={__name:"LeadDetail",setup(b){const A=we(),v=g(!1),a=g(null),M=g([]),N=g(!1),p=g(null),j=ye(()=>{}),W={new:"default",contacted:"info",replied:"warning",qualified:"success",appointment_set:"success",showed:"success",application:"success",funded:"success",closed_lost:"error"};function Q(t){return t?t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"N/A"}function T(t){const e=[];return t.property_address&&e.push(t.property_address),t.property_city&&e.push(t.property_city),t.property_state&&e.push(t.property_state),t.property_zip&&e.push(t.property_zip),e.length>0?e.join(", "):"N/A"}function X(t){const e=[],o=[];t.property_address&&e.push(t.property_address),t.property_city&&o.push(t.property_city),t.property_state&&o.push(t.property_state),t.property_zip&&o.push(t.property_zip);const m=e.length>0?e.join(" "):"",_=o.length>0?o.join(", "):"";return!m&&!_?"N/A":m?_?`${m}
${_}`:m:_}function L(t){return{email_sent:"Email Sent",email_opened:"Email Opened",email_clicked:"Email Clicked",email_replied:"Email Replied",ai_call:"AI Call",appointment:"Appointment",sms_sent:"SMS Sent",sms_replied:"SMS Replied"}[t]||t}function ee(t){return{email_sent:I,email_opened:I,email_clicked:I,email_replied:$,ai_call:Ne,appointment:Ae,sms_sent:Ce,sms_replied:$}[t]||Z}function se(t){return{email_sent:"type-email",email_replied:"type-email-replied",ai_call:"type-call",appointment:"type-appointment",sms_sent:"type-sms",sms_replied:"type-sms"}[t]||"type-default"}function te(t){if(!t)return"Unknown";const e=new Date(t),m=new Date-e,_=Math.floor(m/6e4);if(_<1)return"Just now";if(_<60)return`${_}m ago`;const h=Math.floor(_/60);if(h<24)return`${h}h ago`;const k=Math.floor(h/24);return k<7?`${k}d ago`:e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})}function U(t){if(!t)return"";const e=Math.floor(t/60),o=t%60;return`${e}m ${o}s`}function oe(t,e){return t?t.length<=e?t:t.substring(0,e)+"...":""}function D(t){return t?t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}function B(t){return{positive:"success",appointment_booked:"success",neutral:"default",negative:"error",not_interested:"error",no_response:"warning"}[t]||"default"}function q(t){return t?new Intl.NumberFormat("en-US").format(t):"N/A"}function O(){var t;if(!((t=a.value)!=null&&t.property_address))return"";try{const e="YOUR_API_KEY";if(!e||e==="YOUR_API_KEY")return"";const o=[];a.value.property_address&&o.push(a.value.property_address),a.value.property_city&&o.push(a.value.property_city),a.value.property_state&&o.push(a.value.property_state),a.value.property_zip&&o.push(a.value.property_zip);const m=o.join(", "),_=encodeURIComponent(m),h="Eiffel+Tower,Paris+France";return console.log("Map address:",m),console.log("Encoded address:",_),console.log("Test address:",h),console.log("Full map URL:",`https://www.google.com/maps/embed/v1/place?key=${e}&q=${h}&zoom=16&maptype=roadmap`),`https://www.google.com/maps/embed/v1/search?key=${e}&q=${_}&zoom=16&maptype=roadmap`}catch(e){return console.error("Error creating map URL:",e),""}}function ae(){var o;if(!((o=a.value)!=null&&o.property_address))return;const e=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(T(a.value))}`;window.open(e,"_blank")}function le(){var e;if(!((e=a.value)!=null&&e.property_address))return;const t=T(a.value);navigator.clipboard.writeText(t).then(()=>{var o;(o=window.$message)==null||o.success("Address copied to clipboard")}).catch(()=>{var o;(o=window.$message)==null||o.error("Failed to copy address")})}function ne(t){p.value=t,N.value=!0}function R(t){var e;return t!=null&&t.transcript&&Array.isArray(t.transcript)?t.transcript.filter(o=>o.role==="user"||o.role==="assistant").map(o=>({role:o.role,content:o.content,timestamp:o.timestamp})):((e=t==null?void 0:t.metadata)==null?void 0:e.conversation_transcript)||null}function re(t){return t?new Date(t).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}):""}function ie(t){return t?new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):""}function de(t){if(!t)return"default";const e=parseFloat(t);return e>=8?"success":e>=6?"warning":"error"}function ce(){console.warn("Google Maps iframe failed to load")}function ue(){console.log("Google Maps loaded successfully")}function pe(){window.history.back()}const me=g(!1);function F(){const t=window.pageYOffset||document.documentElement.scrollTop;me.value=t>300}async function _e(){var t,e;v.value=!0;try{const o=A.params.id,{data:m,error:_}=await Y.from("leads").select(`
        *,
        brokers(company_name)
      `).eq("id",o).single();if(_)throw _;a.value={...m,broker_name:((t=m.brokers)==null?void 0:t.company_name)||"Unassigned"};const{data:h,error:k}=await Y.from("interactions").select(`
        *,
        call_evaluations (
          overall_score,
          opening_effectiveness,
          property_discussion_quality,
          objection_handling,
          booking_attempt_quality,
          tone_consistency,
          overall_call_flow,
          analysis,
          evaluated_at
        )
      `).eq("lead_id",o).order("created_at",{ascending:!1});if(k)throw k;M.value=(h||[]).map(K=>{var V;return{...K,evaluation:((V=K.call_evaluations)==null?void 0:V[0])||null}})}catch(o){console.error("Failed to load lead:",o),(e=window.$message)==null||e.error("Failed to load lead details")}finally{v.value=!1}}return he(()=>{window.scrollTo({top:0,behavior:"smooth"}),window.addEventListener("scroll",F),_e()}),ge(()=>{window.removeEventListener("scroll",F)}),(t,e)=>(l(),i(z,null,[s("div",xe,[s("div",Ie,[d(n(S),{quaternary:"",circle:"",onClick:pe,class:"back-button"},{icon:c(()=>[d(n(y),null,{default:c(()=>[d(n($))]),_:1})]),_:1})]),s("div",Pe,[s("div",je,[a.value?(l(),w(n(P),{key:0,class:"info-card",bordered:!1},{default:c(()=>[s("div",Le,[s("div",Ue,[s("h2",null,r(`${a.value.first_name||""} ${a.value.last_name||""}`.trim()||"Unknown Lead"),1)]),s("div",De,[a.value.status?(l(),w(n(C),{key:0,type:W[a.value.status]||"default",size:"small",round:""},{default:c(()=>[f(r(Q(a.value.status)),1)]),_:1},8,["type"])):u("",!0)])]),s("div",Be,[s("div",qe,[s("div",Re,[e[1]||(e[1]=s("span",{class:"detail-label"},"Email:",-1)),s("span",Fe,r(a.value.primary_email||"N/A"),1)]),s("div",Ke,[e[2]||(e[2]=s("span",{class:"detail-label"},"Phone:",-1)),s("span",Ve,r(a.value.primary_phone||"N/A"),1)]),s("div",Ye,[e[3]||(e[3]=s("span",{class:"detail-label"},"Property:",-1)),s("span",Ge,r(X(a.value)),1)])]),s("div",He,[a.value.assigned_broker_id?(l(),i("div",Ze,[e[4]||(e[4]=s("span",{class:"detail-label"},"Broker:",-1)),s("span",Je,r(a.value.broker_name||"Unassigned"),1)])):u("",!0),a.value.property_value?(l(),i("div",We,[e[5]||(e[5]=s("span",{class:"detail-label"},"Value:",-1)),s("span",Qe,"$"+r(q(a.value.property_value)),1)])):u("",!0),a.value.estimated_equity?(l(),i("div",Xe,[e[6]||(e[6]=s("span",{class:"detail-label"},"Equity:",-1)),s("span",es,"$"+r(q(a.value.estimated_equity)),1)])):u("",!0)])])]),_:1})):u("",!0),a.value?(l(),w(n(P),{key:1,class:"map-card",bordered:!1},{default:c(()=>[e[14]||(e[14]=s("div",{class:"map-header"},[s("h3",null,"Property Location")],-1)),s("div",ss,[a.value.property_address?(l(),i("div",os,[j.value&&O()?(l(),i("iframe",{key:0,src:O(),class:"map-iframe",allowfullscreen:"",loading:"lazy",referrerpolicy:"no-referrer-when-downgrade",onError:ce,onLoad:ue},null,40,as)):u("",!0),j.value?O()?u("",!0):(l(),i("div",ns,[d(n(y),{size:"48",class:"map-placeholder-icon"},{default:c(()=>[d(n(x))]),_:1}),s("p",null,r(T(a.value)),1),e[11]||(e[11]=s("p",{class:"map-placeholder-subtitle"},"Add VITE_GOOGLE_MAPS_API_KEY to .env file",-1))])):(l(),i("div",ls,[e[9]||(e[9]=s("p",null,[s("strong",null,"Debug:"),f(" No API key configured")],-1)),s("p",null,[e[8]||(e[8]=s("strong",null,"Lead data:",-1)),f(" "+r(a.value),1)]),e[10]||(e[10]=s("p",null,[s("strong",null,"API Key:"),f(" Missing")],-1))])),s("div",rs,[d(n(S),{type:"primary",size:"small",onClick:ae,class:"action-button"},{icon:c(()=>[d(n(y),null,{default:c(()=>[d(n(x))]),_:1})]),default:c(()=>[e[12]||(e[12]=f(" Open in Maps ",-1))]),_:1}),d(n(S),{type:"info",size:"small",onClick:le,class:"action-button"},{icon:c(()=>[d(n(y),null,{default:c(()=>[d(n(Me))]),_:1})]),default:c(()=>[e[13]||(e[13]=f(" Copy Address ",-1))]),_:1})])])):(l(),i("div",ts,[d(n(y),{size:"48",class:"no-address-icon"},{default:c(()=>[d(n(x))]),_:1}),e[7]||(e[7]=s("p",null,"No address available",-1))]))])]),_:1})):u("",!0)]),s("div",is,[d(n(P),{class:"timeline-card",bordered:!1},{default:c(()=>[e[18]||(e[18]=s("div",{class:"timeline-header"},[s("h3",null,"Timeline")],-1)),v.value?(l(),i("div",ds,[d(n(Oe),{size:"medium"})])):M.value.length===0?(l(),i("div",cs,[d(n(y),{size:"48",class:"empty-icon"},{default:c(()=>[d(n(H))]),_:1}),e[15]||(e[15]=s("p",null,"No interactions yet",-1))])):(l(),i("div",us,[(l(!0),i(z,null,G(M.value,(o,m)=>(l(),i("div",{key:o.id,class:"timeline-item"},[s("div",{class:E(["timeline-line",{last:m===M.value.length-1}])},null,2),s("div",{class:E(["timeline-dot",se(o.type)])},[d(n(y),{size:"16"},{default:c(()=>[(l(),w(be(ee(o.type))))]),_:2},1024)],2),s("div",ps,[s("div",ms,[s("div",_s,[s("span",vs,r(L(o.type)),1),o.direction?(l(),w(n(C),{key:0,type:o.direction==="outbound"?"info":"success",size:"small"},{default:c(()=>[f(r(o.direction),1)]),_:2},1032,["type"])):u("",!0)]),s("span",fs,r(te(o.created_at)),1)]),o.subject?(l(),i("div",ys,r(o.subject),1)):u("",!0),o.content?(l(),i("div",hs,r(oe(o.content,200)),1)):u("",!0),o.duration_seconds?(l(),i("div",gs,[d(n(y),{size:"14"},{default:c(()=>[d(n(H))]),_:1}),s("span",null,r(U(o.duration_seconds)),1)])):u("",!0),o.outcome?(l(),i("div",ws,[s("div",bs,[e[16]||(e[16]=s("span",{class:"outcome-label"},"Outcome:",-1)),d(n(C),{type:B(o.outcome),size:"small"},{default:c(()=>[f(r(D(o.outcome)),1)]),_:2},1032,["type"])]),o.type==="ai_call"?(l(),w(n(S),{key:0,size:"small",type:"primary",ghost:"",circle:"",onClick:_=>ne(o)},{icon:c(()=>[d(n(y),null,{default:c(()=>[d(n(Z))]),_:1})]),_:1},8,["onClick"])):u("",!0)])):u("",!0),o.type==="ai_call"&&o.evaluation?(l(),i("div",ks,[s("div",Cs,[e[17]||(e[17]=s("span",{class:"evaluation-label"},"Call Score:",-1)),d(n(C),{type:de(o.evaluation.overall_score),size:"small"},{default:c(()=>[f(r(o.evaluation.overall_score)+"/10 ",1)]),_:2},1032,["type"])])])):u("",!0)])]))),128))]))]),_:1})])])]),d(n(Te),{show:N.value,"onUpdate:show":e[0]||(e[0]=o=>N.value=o),preset:"card",title:"Call Transcript",size:"large",style:{width:"90%","max-width":"800px"}},{default:c(()=>[p.value?(l(),i("div",Ms,[s("div",Ss,[s("div",As,[s("h3",null,r(L(p.value.type)),1),s("div",Ns,[s("span",Ts,r(ie(p.value.created_at)),1),p.value.duration_seconds?(l(),i("span",Os," Duration: "+r(U(p.value.duration_seconds)),1)):u("",!0),p.value.outcome?(l(),i("span",zs,[e[19]||(e[19]=f(" Outcome: ",-1)),d(n(C),{type:B(p.value.outcome),size:"small"},{default:c(()=>[f(r(D(p.value.outcome)),1)]),_:1},8,["type"])])):u("",!0)])]),p.value.evaluation?(l(),i("div",Es,[e[26]||(e[26]=s("h4",null,"Call Evaluation",-1)),s("div",$s,[s("div",xs,[e[20]||(e[20]=s("span",{class:"score-label"},"Overall Score",-1)),s("span",Is,r(p.value.evaluation.overall_score)+"/10",1)]),s("div",Ps,[e[21]||(e[21]=s("span",{class:"score-label"},"Opening",-1)),s("span",js,r(p.value.evaluation.opening_effectiveness||"N/A")+"/10",1)]),s("div",Ls,[e[22]||(e[22]=s("span",{class:"score-label"},"Property Discussion",-1)),s("span",Us,r(p.value.evaluation.property_discussion_quality||"N/A")+"/10",1)]),s("div",Ds,[e[23]||(e[23]=s("span",{class:"score-label"},"Objection Handling",-1)),s("span",Bs,r(p.value.evaluation.objection_handling||"N/A")+"/10",1)]),s("div",qs,[e[24]||(e[24]=s("span",{class:"score-label"},"Booking Attempt",-1)),s("span",Rs,r(p.value.evaluation.booking_attempt_quality||"N/A")+"/10",1)]),s("div",Fs,[e[25]||(e[25]=s("span",{class:"score-label"},"Tone Consistency",-1)),s("span",Ks,r(p.value.evaluation.tone_consistency||"N/A")+"/10",1)])])])):u("",!0)]),s("div",Vs,[e[28]||(e[28]=s("h4",null,"Conversation Transcript",-1)),d(n(Ee),{style:{"max-height":"400px"}},{default:c(()=>[R(p.value)?(l(),i("div",Ys,[(l(!0),i(z,null,G(R(p.value),(o,m)=>(l(),i("div",{key:m,class:E(["transcript-message",o.role])},[s("div",Gs,[s("span",Hs,r(o.role==="assistant"?"Barbara (AI)":"Caller"),1),s("span",Zs,r(re(o.timestamp)),1)]),s("div",Js,[s("div",Ws,r(o.text||o.content),1)])],2))),128))])):(l(),i("div",Qs,[...e[27]||(e[27]=[s("p",null,"No transcript available for this call.",-1)])]))]),_:1})])])):u("",!0)]),_:1},8,["show"])],64))}},ht=ke(Xs,[["__scopeId","data-v-c2580c2e"]]);export{ht as default};
